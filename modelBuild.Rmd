---
title: "modelBuild"
author: "Caitlin Seibel"
date: "2023-12-04"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(MASS)
```

```{r loadData}
final <- read.csv("finalModelData.csv")

final$Race <- relevel(as.factor(final$Race), ref = "White")
final$Gender <- relevel(as.factor(final$Gender), ref = "M")
final$Cause_of_Death <- relevel(as.factor(final$Cause_of_Death), ref = "All other non-drug and non-alcohol causes")
final$Age <- relevel(as.factor(final$Age), ref = "Under 5 years")
final$COVID <- as.factor(final$COVID)
```

```{r}
#check for na values
sum(is.na(final))

#looking at distribution of response/ check for overdispersion and excess zeros
summary(final$Deaths, na.rm = T)
hist(final$Deaths)
length(final[final$Deaths == 0,])
mean(final$Deaths, na.rm = T)
var(final$Deaths, na.rm = T)

```
```{r model}
#first model: no interactions ----
#first try Poisson
modelP1 <- glm(Deaths ~ Cause_of_Death + Gender + Age + Race + COVID + offset(log(Population)),
               family = "poisson"(link = "log"),
               data = final)
summary(modelP1)
anova(modelP1)

#check for overdispersion pt 2
modelP1$deviance/modelP1$df.residual #117.2301 > 1, so we have an issue with overdispersion


#now try Neg Binomial
modelNB1 <- glm.nb(Deaths ~ Cause_of_Death + Gender + Age + Race + COVID + offset(log(Population)), 
                 link = log,
                 data = final)

summary(modelNB1)


```
```{r}
#next models: interactions
```

