---
title: "Drug and Alcohol Related Deaths: 2018-2021 CDC and Census Data Cleaning, Analysis, and RShiny App Development"
author: "Caitlin Seibel, Emily Geis, Casey Schmidt"
date: "December 15, 2023"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gtsummary)
library(tableone)
library(knitr)
library(rmarkdown)
library(kableExtra)
library(ggplot2)
library(magick)

dataFinal = read.csv("finalModelData.csv")
```

\section{Introduction}

```{=latex}
\begin{minipage}[t]{0.5\linewidth}
```

|     Illicit substance use is known to have several health related consequences, including cardiovascular disease, cancer, and death [1]. Opioid misuse has risen in the United States from the first wave of prescription opioid overdoses in the 1990s to the rise of synthetic opioid use (i.e. fentanyl) in 2013 [2], calling for concern on (potentially) increasing deaths from drug or alcohol related causes. We analyzed data obtained from the Centers for Disease Control and Prevention (CDC) [3] and the U.S. Census Bureau [4] to make inferences on drug and alcohol related death counts, adjusting for age, gender, racial strata, and an indicator of the COVID-19 pandemic. 

|     Table 1 shows counts of demographic variables we have available in this data set, as well as the counts for the cause of death. Note that 65\% of deaths are from non-drug and non-alcohol induced causes since these include all deaths unrelated to drugs or alcohol. Also note that the standard deviation of the deaths is about 3800 with a approximate mean of 957, indicating high variability in the deaths. Plotting two visualizations of this shows that there is high variability in the death counts.

```{=latex}
\end{minipage}%
\begin{minipage}[t]{0.5\linewidth}
```
```{r Table 1, fig.align = 'right', echo=FALSE, message=FALSE}

dataFinal = na.omit(dataFinal)

dataFinal$Gender = ifelse(dataFinal$Gender == "M", "Male", "Female")
dataFinal$Ages = dataFinal$Age
dataFinal$Age = factor(dataFinal$Age, levels = unique(dataFinal$Age))

dataFinal$Race <- relevel(as.factor(dataFinal$Race), ref = "White")
dataFinal$Gender <- relevel(as.factor(dataFinal$Gender), ref = "Male")
dataFinal$Cause_of_Death <- relevel(as.factor(dataFinal$Cause_of_Death), ref = "All other non-drug and non-alcohol causes")
dataFinal$Age <- relevel(as.factor(dataFinal$Age), ref = "Under 5 years")
dataFinal$COVID <- as.factor(dataFinal$COVID)

#dataFinal %>%
  #select(Age, Cause_of_Death, Gender, Race) %>%
  #tbl_summary(label = list(Cause_of_Death ~ "Cause of Death"))
  
kableone(CreateTableOne(data = dataFinal, vars = c("Deaths", "Cause_of_Death", "Age", "Race", "Gender", "COVID")), booktabs = T, caption = "Descriptive statistics") %>%
  add_indent(positions = c(4:6, 8:24, 26:31)) %>% 
  kable_paper(full_width = F, font_size = 8, ) %>%
  as_image(width = 4)
```
```{=latex}
\end{minipage}
```


\section{Methods}
\subsection{Data Preprocessing}

|     Deaths from drug or alcohol use is defined as: if drugs or alcohol was the catalyst in a series of events that led to death [2]. 2018-2021 death count data obtained from the CDC was requested based on five-year age categories, gender (male/female), six racial groups (American Indian or Alaskan Native, Asian, Black or African American, Native Hawaiian or Other Pacific Islander, White, and More Than One Race), cause of death (Drug, Alcohol, and Non-drug/non-alcohol), and month of death. Population data for these strata groupings were unavailable. 

|     To make inferences about death-rate differences between substrata populations, 2020-2022 data obtained from the Census used similar strata as the CDC. Two differences between the data were the characterizations of the five-year age groups and monthly/yearly population counts. CDC characterized individuals who died before a year old as their own group; they also count all five year age groups up to 100 as unique groups. The Census collapses these into $<5$ and $> 85$, with unique categories for five-year groups between these ages. CDC death count data was aggregated to match the Census strata. Further, Census data was only available on yearly 2020-2022 estimates, whereas we have monthly CDC data from 2018. We assumed the population is stable throughout a given year and that the rate of change within substrata is constant between years. By these assumptions, we estimated the substrata population counts for 2018 and 2019. 

```{=latex}
\begin{minipage}[t]{0.5\linewidth}
```

```{r Histogram of deaths, fig.height=3, fig.width=3, message=FALSE, echo=FALSE}
ggplot(data = dataFinal, aes(x = Deaths)) +
  geom_histogram() +
  theme_bw() +
  ggtitle("Figure 1: Distribution of Death Counts") +
  theme(plot.title = element_text(size=10))

```

```{=latex}
\end{minipage}%
\begin{minipage}[t]{0.5\linewidth}
```

```{r Plot of Death Counts over Time, echo = FALSE, message=FALSE, fig.height=5, fig.width=5}
dataFinal$CauseOfDeath = ifelse(dataFinal$Cause_of_Death == "All other non-drug and non-alcohol causes", "All other",
                                ifelse(dataFinal$Cause_of_Death == "Drug-induced causes", "Drug-induced", "Alcohol-induced"))

ggplot(data = na.omit(dataFinal), aes(x = Year, y = Deaths)) +
  stat_summary(aes(color = CauseOfDeath, linetype = CauseOfDeath), 
               geom = "line", fun = mean, linewidth = 1) + 
  theme_bw()+
  ggtitle("Figure 2: Average Death Counts over Time by Cause") + 
  #scale_fill_discrete(labels = c("All other causes", "Alcohol-related", "Drug-related")) +
  theme(legend.position = "bottom")
```
```{=latex}
\end{minipage}
```

|     Looking at the dates included in the model, we assumed that the COVID-19 pandemic will skew the death counts upwards. Plotting death counts over time, we see this assumption may hold, so we created an indicator to distinguish months before and after March 2020, which we are taking as the beginning of the COVID-19 pandemic in the U.S. 

\subsection{Model Building}
|     To analyze our data, we choose a Generalized Linear Model (GLM). Our outcome variable of interest is number of deaths per month, referred to in our model simply as "Deaths". Our main predictor of interests are cause of death: drug related, alcohol related, or non-drug/alcohol related, and indicator of COVID-19 pandemic: 0 if before the start of the COVID-19 pandemic (defined here as March 2020), or 1 if after. Our other demographic covariates include age group, gender, and race. We also want to investigate the possible interaction between cause of death and the indicator of COVID-19 pandemic. Our outcome is a count variable so we initially assume a Poisson distribution. We use log(Population) as an offset for the model, since we want to model count rather than rate. Our initial GLM model is as follows.

$$ \hat{log(Deaths)} = \hat{\beta_0} + log(Population) + \hat{\beta_1} Cause + \hat{\beta_2} Gender + \hat{\beta_3} Age + \hat{\beta_4} Race + \hat{\beta_5} COVID + \hat{\beta_6} Cause \times COVID$$
|     Since we are using a Poisson distribution, we need to check for overdispersion, or a violation of the assumption of equal mean and variance. To check for this violation, we will run our model and calculate the deviance divided by the residual degrees of freedom. If the equal mean and variance assumption is met, we expect this value to be approximately 1. From our model, we calculate this metric as 111.4576, which is much larger than 1, so we have evidence of overdispersion. To account for this overdispersion, we will use a negative binomial outcome for our GLM.

\section{Results}

\subsection{RShiny App}

|     To create an interactive platform through which users can visualize different trends in the data, we created an RShiny app that offers a couple different features and methods that can be used to analyze our data. There are two overarching options in our app; regression model building and trend visualization. The main page, titled "Analysis", is where a regression model can be built and the second page, titled "Exploratory Plots", is where data trend visualization can be performed. 

|     The main page of the app features a couple of drop down lists to select different aspects of a regression model. You can first select the desired outcome variable from a list of all available variables in the dataset, and then you can select all of the covariates you're interested in including in the model. There is also an option to include interaction terms in the model, but this is not necessary to run the regression. Once these variables are selected, the app runs a glm in the background with a negative binomial distribution assumption and an offset of the log of the total population (see above for further model description). The first tab on this page shows the summary of the regression model, with the $\beta$ estimates, p-values, and other relevant model estimates. The second tab on this page shows the residual plot resulting from the model, with the fitted values on the x-axis and the residual values on the y-axis. The final tab on this page shows the ANOVA output of the model, giving relevant statistics for all selected variables and interaction terms. 

|     The second page provides the option to create exploratory plots to visualize trends in the data. There are two drop-down lists from which the y variable and the variable on which to stratify on can be selected. There are four choices in the drop-down menu for the y-variable. The options are the total population, the total death count, only the alcohol-related deaths, and only the drug-related deaths. If either the alcohol-related deaths or the drug-related deaths are chosen, the app works in the background to create a subset of the full data set that consists only of the relevant cause of death. The time variable on the x-axis is automatically set as Years. After creating the plot, the trends in the selected y variable are visible and separated for each group in the selected stratification variable. The output is color-coded and a key is provided.


\section{Discussion}

\section{References}

[1] National Institute on Drug Abuse. What are the other health consequences of drug addiction? 2020, URL: https://nida.nih.gov/publications/drugs-brains-behavior-science-addiction/addiction-health 

[2] Centers for Disease Control and Prevention [CDC]. Understanding the Opioid Epidemic. 2023. URL: https://www.cdc.gov/opioids/basics/epidemic.html

[3] Centers for Disease Control and Prevention [CDC], Alcohol Use. 2023. URL: https://www.cdc.gov/nchs/fastats/alcohol.htm

[4] United States Census Bureau [USCB]. National Population by Characteristics 2020-2022. 2023. https://www.census.gov/data/tables/time-series/demo/popest/2020s-national-detail.html
